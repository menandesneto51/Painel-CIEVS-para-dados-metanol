<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Painel de Monitoramento ‚Äì Intoxica√ß√£o por Suspeita de Metanol (SES-MT)</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-100">
  <div id="root"></div>

  <script type="text/babel" data-presets="env,react">
    const { useEffect, useMemo, useState, useRef } = React;

    const App = () => {
      // L√≥gica de Data Atualizada:
      // Se hor√°rio < 10h -> usa hor√°rio da m√°quina.
      // Se hor√°rio >= 10h -> fixa em "√†s 10h".
      const lastUpdate = useMemo(() => {
        const now = new Date();
        const hour = now.getHours(); // Pega a hora local da m√°quina

        // Formata√ß√£o da Data (Dia de M√™s de Ano)
        const day = new Intl.DateTimeFormat("pt-BR", { day: "2-digit" }).format(now);
        const monthRaw = new Intl.DateTimeFormat("pt-BR", { month: "long" }).format(now);
        const month = monthRaw.charAt(0).toUpperCase() + monthRaw.slice(1);
        const year = new Intl.DateTimeFormat("pt-BR", { year: "numeric" }).format(now);
        const datePart = `${day} de ${month} de ${year}`;

        if (hour < 10) {
          // Usa o hor√°rio da m√°quina (HH:mm)
          const timePart = new Intl.DateTimeFormat("pt-BR", {
            hour: "2-digit",
            minute: "2-digit",
          }).format(now);
          return `${datePart} √†s ${timePart}`;
        } else {
          // Fixa √†s 10h
          return `${datePart} √†s 10h`;
        }
      }, []);

      const [activeTab, setActiveTab] = useState("geral");
      const [selectedCase, setSelectedCase] = useState(null);
      const [animateCards, setAnimateCards] = useState(false);
      const mapRef = useRef(null); // Inst√¢ncia do mapa Leaflet

      useEffect(() => {
        setAnimateCards(true);
      }, []);

      // ======================
      // DADOS DOS CASOS
      // ======================

      // 6 CONFIRMADOS (Grave)
      const casosConfirmados = [
        {
          id: 1,
          status: "CONFIRMADO",
          municipioResidencia: "V√°rzea Grande",
          municipioInternacao: "V√°rzea Grande",
          cidade: "V√°rzea Grande",
          perfil: "Masculino, 24 anos",
          descricao: null,
          statusColor: "bg-red-600",
          borderColor: "border-red-400",
          data: "20/10/2025",
          gravidade: "Grave",
          evolucao: "Em acompanhamento",
          necessitouHospitalizacao: "Sim",
          permaneceHospitalizado: "N√£o",
          recebeuAntidoto: "Sim",
          isObitoMetanol: false,
          isObitoOutrasCausas: false,
        },
        {
          id: 10,
          status: "CONFIRMADO",
          municipioResidencia: "V√°rzea Grande",
          municipioInternacao: "V√°rzea Grande",
          cidade: "V√°rzea Grande",
          perfil: "Feminino, 30 anos",
          descricao:
            "Paciente encaminhada por familiares j√° em √≥bito. Investiga√ß√£o conduzida pelo SVO.",
          statusColor: "bg-red-600",
          borderColor: "border-red-400",
          data: "06/11/2025",
          gravidade: "Grave",
          evolucao: "√ìbito por intoxica√ß√£o ex√≥gena confirmada por metanol",
          necessitouHospitalizacao: "N√£o", // chegou j√° em √≥bito
          permaneceHospitalizado: "N√£o",
          recebeuAntidoto: "N√£o",
          isObitoMetanol: true,
          isObitoOutrasCausas: false,
        },
        {
          id: 8,
          status: "CONFIRMADO",
          municipioResidencia: "Itanhang√°",
          municipioInternacao: "Sorriso",
          cidade: "Itanhang√°",
          perfil: "Masculino, 26 anos",
          descricao: null,
          statusColor: "bg-red-600",
          borderColor: "border-red-400",
          data: "03/11/2025",
          gravidade: "Grave",
          evolucao: "Em acompanhamento",
          necessitouHospitalizacao: "Sim",
          permaneceHospitalizado: "N√£o",
          recebeuAntidoto: "N√£o",
          isObitoMetanol: false,
          isObitoOutrasCausas: false,
        },
        {
          id: 9,
          status: "CONFIRMADO",
          municipioResidencia: "Itanhang√°",
          municipioInternacao: "Sorriso",
          cidade: "Itanhang√°",
          perfil: "Feminino, 42 anos",
          descricao: null,
          statusColor: "bg-red-600",
          borderColor: "border-red-400",
          data: "03/11/2025",
          gravidade: "Grave",
          evolucao: "√ìbito por intoxica√ß√£o ex√≥gena confirmada por metanol",
          necessitouHospitalizacao: "Sim",
          permaneceHospitalizado: "N√£o",
          recebeuAntidoto: "Sim",
          isObitoMetanol: true,
          isObitoOutrasCausas: false,
        },
        {
          id: 13,
          status: "CONFIRMADO",
          municipioResidencia: "Nova Brasil√¢ndia",
          municipioInternacao: "Cuiab√°",
          cidade: "Nova Brasil√¢ndia ‚Üí Internado em Cuiab√°",
          perfil: "Masculino, 33 anos",
          descricao: "Exame toxicol√≥gico positivo para metanol. Caso confirmado.",
          statusColor: "bg-red-600",
          borderColor: "border-red-400",
          data: "17/11/2025",
          gravidade: "Grave",
          evolucao: "Permanece internado em Cuiab√°",
          necessitouHospitalizacao: "Sim",
          permaneceHospitalizado: "Sim",
          recebeuAntidoto: "Sim",
          isObitoMetanol: false,
          isObitoOutrasCausas: false,
        },
        {
          id: 14,
          status: "CONFIRMADO",
          municipioResidencia: "Quer√™ncia",
          municipioInternacao: "Barra do Gar√ßas",
          cidade: "Quer√™ncia ‚Üí Internado em Barra do Gar√ßas",
          perfil: "Masculino, 24 anos",
          descricao: "Exame toxicol√≥gico positivo para metanol. Caso confirmado.",
          statusColor: "bg-red-600",
          borderColor: "border-red-400",
          data: "18/11/2025",
          gravidade: "Grave",
          evolucao: "√ìbito por intoxica√ß√£o ex√≥gena confirmada por metanol",
          necessitouHospitalizacao: "Sim",
          permaneceHospitalizado: "N√£o",
          recebeuAntidoto: "N√£o",
          isObitoMetanol: true,
          isObitoOutrasCausas: false,
        },
      ];

      // EM INVESTIGA√á√ÉO (Agora apenas 1 caso restante)
      const casosEmInvestigacao = [
        {
          id: 15,
          status: "EM INVESTIGA√á√ÉO",
          municipioResidencia: "Cuiab√°",
          municipioInternacao: "Cuiab√°",
          cidade: "Cuiab√°",
          perfil: "Feminino, 26 anos",
          descricao: "Aguardando resultado laboratorial.",
          statusColor: "bg-yellow-500",
          borderColor: "border-yellow-400",
          data: "24/11/2025",
          gravidade: "Grave",
          evolucao: "Em investiga√ß√£o",
          necessitouHospitalizacao: "Sim",
          permaneceHospitalizado: "N√£o",
          recebeuAntidoto: "N√£o",
          isObitoMetanol: false,
          isObitoOutrasCausas: false,
        },
      ];

      // DESCARTADOS
      const casosDescartados = [
        // CASO √ÅGUA BOA (Atualizado: Removido o n√∫mero RAI)
        {
          id: 2,
          status: "DESCARTADO",
          municipioResidencia: "√Ågua Boa",
          municipioInternacao: "Goi√¢nia",
          cidade: "√Ågua Boa ‚Üí Internado em Goi√¢nia",
          perfil: "Masculino, 27 anos",
          descricao: "Conforme Laudo Pericial Criminal, emitido pelo Instituto de Criminal√≠stica Leonardo Rodrigues, da Superintend√™ncia de Pol√≠cia T√©cnico-Cient√≠fica da Secretaria de Estado da Seguran√ßa P√∫blica de Goi√°s, n√£o houve detec√ß√£o de etanol, metanol ou √°cido f√≥rmico nas amostras de sangue e urina coletadas do referido paciente. Dessa forma, o CIATox (Centro de Informa√ß√£o e Assist√™ncia Toxicol√≥gica de Goi√°s)/GESP(Ger√™ncia de Emerg√™ncia em Sa√∫de P√∫blica)/SUVEPI/SUVISA/SES-GO, pauta-se no laudo pericial, que apresentou resultado NEGATIVO para os anal√≠ticos investigados.",
          statusColor: "bg-green-700",
          borderColor: "border-green-400",
          data: "21/10/2025",
          tipo: "Descartado",
          gravidade: "N√£o se aplica",
          evolucao: "Caso descartado ap√≥s laudo negativo",
          necessitouHospitalizacao: "Sim",
          permaneceHospitalizado: "Sim",
          recebeuAntidoto: "Sim",
          isObitoMetanol: false,
          isObitoOutrasCausas: false,
        },
        {
          id: 12,
          status: "DESCARTADO",
          municipioResidencia: "Nova Mutum",
          municipioInternacao: "Nova Mutum",
          cidade: "Nova Mutum",
          perfil: "Masculino, 30 anos",
          descricao:
            "Exame toxicol√≥gico laboratorial negativo para metanol. Caso descartado clinicamente.",
          statusColor: "bg-green-700",
          borderColor: "border-green-400",
          data: "05/10/2025",
          tipo: "Descartado",
          gravidade: "N√£o se aplica",
          evolucao: "Caso descartado",
          necessitouHospitalizacao: "Sim",
          permaneceHospitalizado: "N√£o",
          recebeuAntidoto: "N√£o",
          isObitoMetanol: false,
          isObitoOutrasCausas: false,
        },
        {
          id: 4,
          status: "DESCARTADO",
          municipioResidencia: "V√°rzea Grande",
          municipioInternacao: "V√°rzea Grande",
          cidade: "V√°rzea Grande",
          perfil: "Masculino, 30 anos",
          descricao:
            "Exame toxicol√≥gico laboratorial negativo para metanol em amostra biol√≥gica. Caso descartado conforme crit√©rios cl√≠nico-laboratoriais.",
          statusColor: "bg-green-700",
          borderColor: "border-green-400",
          data: "24/10/2025",
          tipo: "Descartado",
          gravidade: "N√£o se aplica",
          evolucao: "Caso descartado",
          necessitouHospitalizacao: "Sim",
          permaneceHospitalizado: "N√£o",
          recebeuAntidoto: "N√£o",
          isObitoMetanol: false,
          isObitoOutrasCausas: false,
        },
        {
          id: 5,
          status: "DESCARTADO",
          municipioResidencia: "Cuiab√°",
          municipioInternacao: "Cuiab√°",
          cidade: "Cuiab√°",
          perfil: "Feminino, 18 anos",
          descricao:
            "Exame toxicol√≥gico laboratorial negativo para metanol em amostra biol√≥gica. Caso descartado conforme crit√©rios cl√≠nico-laboratoriais.",
          statusColor: "bg-green-700",
          borderColor: "border-green-400",
          data: "28/10/2025",
          tipo: "Descartado",
          gravidade: "N√£o se aplica",
          evolucao: "Caso descartado",
          necessitouHospitalizacao: "Sim",
          permaneceHospitalizado: "N√£o",
          recebeuAntidoto: "N√£o",
          isObitoMetanol: false,
          isObitoOutrasCausas: false,
        },
        {
          id: 6,
          status: "DESCARTADO",
          municipioResidencia: "Sorriso",
          municipioInternacao: "Sorriso",
          cidade: "Sorriso",
          perfil: "Masculino, 30 anos",
          descricao:
            "Exame toxicol√≥gico laboratorial negativo para metanol em amostra biol√≥gica. Caso descartado conforme crit√©rios cl√≠nico-laboratoriais.",
          statusColor: "bg-green-700",
          borderColor: "border-green-400",
          data: "19/10/2025",
          tipo: "Descartado",
          gravidade: "N√£o se aplica",
          evolucao: "Caso descartado",
          necessitouHospitalizacao: "Sim",
          permaneceHospitalizado: "N√£o",
          recebeuAntidoto: "N√£o",
          isObitoMetanol: false,
          isObitoOutrasCausas: false,
        },
        {
          id: 7,
          status: "DESCARTADO",
          municipioResidencia: "Peixoto de Azevedo",
          municipioInternacao: "Peixoto de Azevedo",
          cidade: "Peixoto de Azevedo",
          perfil: "Feminino, 38 anos",
          descricao: "Caso descartado pela equipe de vigil√¢ncia.",
          statusColor: "bg-green-700",
          borderColor: "border-green-400",
          data: "20/10/2025",
          tipo: "Descartado",
          gravidade: "N√£o se aplica",
          evolucao: "Caso descartado",
          necessitouHospitalizacao: "Sim",
          permaneceHospitalizado: "N√£o",
          recebeuAntidoto: "N√£o",
          isObitoMetanol: false,
          isObitoOutrasCausas: false,
        },
        {
          id: 11,
          status: "DESCARTADO",
          municipioResidencia: "V√°rzea Grande",
          municipioInternacao: "V√°rzea Grande",
          cidade: "V√°rzea Grande",
          perfil: "Masculino, 40 anos",
          descricao:
            "Exame toxicol√≥gico laboratorial negativo para metanol em amostra biol√≥gica. Caso descartado conforme crit√©rios cl√≠nico-laboratoriais.",
          statusColor: "bg-green-700",
          borderColor: "border-green-400",
          data: "22/10/2025",
          tipo: "√ìbito - Descartado",
          gravidade: "N√£o se aplica",
          evolucao: "√ìbito por outras causas",
          necessitouHospitalizacao: "Sim",
          permaneceHospitalizado: "N√£o",
          recebeuAntidoto: "Sim",
          isObitoMetanol: false,
          isObitoOutrasCausas: true,
        },
        // NOVO CASO INSERIDO (Mirassol D'oeste)
        {
          id: 16,
          status: "DESCARTADO",
          municipioResidencia: "Mirassol D'oeste",
          municipioInternacao: "Mirassol D'oeste",
          cidade: "Mirassol D'oeste",
          perfil: "Masculino, 20 anos",
          descricao: "Caso descartado pela equipe de vigil√¢ncia.",
          statusColor: "bg-green-700",
          borderColor: "border-green-400",
          data: "01/12/2025",
          tipo: "Descartado",
          gravidade: "N√£o se aplica",
          evolucao: "Caso descartado",
          necessitouHospitalizacao: "Sim",
          permaneceHospitalizado: "N√£o",
          recebeuAntidoto: "N√£o",
          isObitoMetanol: false,
          isObitoOutrasCausas: false,
        }
      ];

      const todosCasos = [
        ...casosConfirmados,
        ...casosEmInvestigacao,
        ...casosDescartados,
      ];

      // ======================
      // KPIs
      // ======================
      const totalNotificado = todosCasos.length;
      const totalConfirmado = casosConfirmados.length;
      const totalEmInvestigacao = casosEmInvestigacao.length;
      const totalDescartado = casosDescartados.length;

      const totalObitosMetanol = todosCasos.filter(
        (caso) => caso.isObitoMetanol
      ).length;

      const totalInternadosAtualmente = todosCasos.filter(
        (caso) => String(caso.permaneceHospitalizado).toLowerCase() === "sim"
      ).length;

      const totalReceberamAntidoto = todosCasos.filter(
        (caso) => String(caso.recebeuAntidoto).toLowerCase() === "sim"
      ).length;

      const kpiData = [
        {
          label: "Total Notificado",
          value: totalNotificado,
          icon: "üë•",
          borderColor: "border-blue-600",
          textColor: "text-blue-700",
          iconColor: "text-blue-600",
        },
        {
          label: "Confirmado",
          value: totalConfirmado,
          icon: "‚ö†Ô∏è",
          borderColor: "border-red-600",
          textColor: "text-red-700",
          iconColor: "text-red-600",
        },
        {
          label: "Em Investiga√ß√£o",
          value: totalEmInvestigacao,
          icon: "üîç",
          borderColor: "border-yellow-600",
          textColor: "text-yellow-700",
          iconColor: "text-yellow-600",
        },
        {
          label: "Descartados",
          value: totalDescartado,
          icon: "‚úÖ",
          borderColor: "border-green-600",
          textColor: "text-green-700",
          iconColor: "text-green-600",
        },
        {
          label: "√ìbitos por metanol",
          value: totalObitosMetanol,
          icon: "‚ò†Ô∏è",
          borderColor: "border-gray-700",
          textColor: "text-gray-800",
          iconColor: "text-gray-700",
        },
        {
          label: "Casos atualmente internados",
          value: totalInternadosAtualmente,
          icon: "üè•",
          borderColor: "border-orange-500",
          textColor: "text-orange-700",
          iconColor: "text-orange-500",
        },
        {
          label: "Receberam ant√≠doto",
          value: totalReceberamAntidoto,
          icon: "üíâ",
          borderColor: "border-indigo-500",
          textColor: "text-indigo-700",
          iconColor: "text-indigo-500",
        },
      ];

      // ======================
      // DISTRIBUI√á√ÉO POR MUNIC√çPIO (Resid√™ncia)
      // ======================
      const cidadesAfetadas = Object.values(
        todosCasos.reduce((acc, caso) => {
          const baseResidencia = caso.municipioResidencia || caso.cidade;
          const nomeCidade = baseResidencia.includes("(HPSMVG)")
            ? "V√°rzea Grande"
            : baseResidencia;

          if (!acc[nomeCidade]) {
            acc[nomeCidade] = {
              cidade: nomeCidade,
              casos: 0,
              internacoes: {},
            };
          }

          acc[nomeCidade].casos += 1;

          const localInternacao = caso.municipioInternacao || nomeCidade;
          if (!acc[nomeCidade].internacoes[localInternacao]) {
            acc[nomeCidade].internacoes[localInternacao] = 0;
          }
          acc[nomeCidade].internacoes[localInternacao] += 1;

          return acc;
        }, {})
      ).sort((a, b) => b.casos - a.casos);

      // ======================
      // COORDENADAS (Mapa)
      // ======================
      const coordsMunicipios = {
        "Cuiab√°": { lat: -15.601, lng: -56.097 },
        "V√°rzea Grande": { lat: -15.646, lng: -56.132 },
        "Nova Mutum": { lat: -13.837, lng: -56.074 },
        "Sorriso": { lat: -12.542, lng: -55.721 },
        "Itanhang√°": { lat: -12.255, lng: -56.646 },
        "Peixoto de Azevedo": { lat: -10.225, lng: -54.979 },
        "Nova Brasil√¢ndia": { lat: -14.961, lng: -54.301 },
        "Quer√™ncia": { lat: -12.593, lng: -52.197 },
        "√Ågua Boa": { lat: -14.049, lng: -52.160 },
        "Barra do Gar√ßas": { lat: -15.889, lng: -52.256 },
        "Goi√¢nia": { lat: -16.686, lng: -49.264 },
        "Mirassol D'oeste": { lat: -15.676, lng: -58.096 }, // Coordenadas inseridas
      };

      // ======================
      // HELPERS
      // ======================
      const getDescricaoPadrao = (caso) => {
        if (caso.status === "CONFIRMADO") {
          return "Exame toxicol√≥gico laboratorial positivo para metanol em amostra biol√≥gica. Caso confirmado conforme crit√©rios cl√≠nico-laboratoriais.";
        }
        if (caso.descricao) {
          return caso.descricao;
        }
        if (caso.status === "EM INVESTIGA√á√ÉO") {
          return "Aguardando resultado laboratorial.";
        }
        if (caso.status === "DESCARTADO") {
          return "Caso descartado conforme crit√©rios cl√≠nico-laboratoriais.";
        }
        return "";
      };

      const getGravidadeClasses = (gravidade) => {
        if (gravidade === "Grave") {
          return "bg-red-50 text-red-700 border-red-100";
        }
        if (gravidade === "N√£o se aplica") {
          return "bg-gray-50 text-gray-700 border-gray-100";
        }
        return "bg-gray-50 text-gray-700 border-gray-100";
      };

      const formatStatusSimNao = (valor) => {
        if (valor === null || valor === undefined) return "N√£o informado";
        const v = String(valor).toLowerCase();
        if (v === "sim") return "Sim";
        if (v === "nao" || v === "n√£o") return "N√£o";
        return "N√£o informado";
      };

      // LISTA DE CASOS (cards)
      const renderListaCasos = (lista, corBordaEsquerda) => (
        <div className={"bg-white p-6 rounded-xl shadow-lg border-l-8 " + corBordaEsquerda}>
          <div className="space-y-4">
            {lista.map((caso) => (
              <div
                key={caso.id}
                className="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow duration-300 cursor-pointer"
                onClick={() => setSelectedCase(caso)}
              >
                <div className="flex items-start gap-3">
                  <span
                    className={
                      caso.statusColor +
                      " text-white text-xs font-bold px-3 py-1 rounded-full whitespace-nowrap flex items-center gap-1"
                    }
                  >
                    {caso.status === "CONFIRMADO" && "‚ö†Ô∏è"}
                    {caso.status === "EM INVESTIGA√á√ÉO" && "üîç"}
                    {caso.status === "DESCARTADO" && "‚úÖ"}
                    <span>{caso.status}</span>
                  </span>

                  <div className="flex-1">
                    <div className="flex items-center gap-2 mb-1">
                      <span className="text-gray-500 text-lg">üìç</span>
                      <span className="font-semibold text-gray-800">
                        Resid√™ncia: {caso.municipioResidencia || caso.cidade}
                      </span>
                    </div>
                    {caso.municipioInternacao && (
                      <p className="text-xs text-gray-500 mb-1">
                        Interna√ß√£o: {caso.municipioInternacao}
                      </p>
                    )}

                    <p className="text-sm text-gray-500 mb-1">({caso.perfil})</p>
                    <p className="text-xs text-gray-400 mb-1">{caso.data}</p>

                    <p className="text-sm text-gray-600 border-l-2 border-gray-300 pl-3">
                      {getDescricaoPadrao(caso)}
                    </p>

                    <div className="mt-1 flex flex-wrap items-center gap-x-2 gap-y-1">
                      {caso.isObitoMetanol && (
                        <span className="inline-flex items-center gap-1 text-xs font-semibold text-red-700 bg-red-50 border border-red-200 rounded-full px-2 py-0.5">
                          ‚ò†Ô∏è √ìbito confirmado por metanol
                        </span>
                      )}
                      {caso.isObitoOutrasCausas && (
                        <span className="inline-flex items-center gap-1 text-xs font-semibold text-gray-700 bg-gray-50 border border-gray-200 rounded-full px-2 py-0.5">
                          ‚ö´ √ìbito por outras causas
                        </span>
                      )}
                    </div>

                    <p className="text-xs text-gray-500 mt-2">
                      <span className="font-semibold">Evolu√ß√£o:</span> {caso.evolucao}
                    </p>
                    {caso.gravidade && (
                      <p className="text-xs text-gray-500 mt-1">
                        <span className="font-semibold">Gravidade:</span> {caso.gravidade}
                      </p>
                    )}
                    <p className="text-xs text-gray-500 mt-1">
                      <span className="font-semibold">Necessitou hospitaliza√ß√£o:</span>{" "}
                      {formatStatusSimNao(caso.necessitouHospitalizacao)}
                    </p>
                    <p className="text-xs text-gray-500 mt-1">
                      <span className="font-semibold">Permanece hospitalizado:</span>{" "}
                      {formatStatusSimNao(caso.permaneceHospitalizado)}
                    </p>
                    <p className="text-xs text-gray-500 mt-1">
                      <span className="font-semibold">Recebeu ant√≠doto:</span>{" "}
                      {formatStatusSimNao(caso.recebeuAntidoto)}
                    </p>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      );

      // ======================
      // INICIALIZA√á√ÉO DO MAPA LEAFLET
      // ======================
      useEffect(() => {
        if (activeTab !== "mapa") return;
        if (typeof L === "undefined") return;

        const initMap = () => {
          const container = document.getElementById("map");
          if (!container) return;

          // Se o mapa j√° existe, apenas ajusta o tamanho
          if (mapRef.current) {
            mapRef.current.invalidateSize();
            return;
          }

          const map = L.map("map").setView([-13.5, -56.0], 5.7);
          mapRef.current = map;

          L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            maxZoom: 18,
            attribution: "¬© OpenStreetMap contributors",
          }).addTo(map);

          // Adiciona marcadores por munic√≠pio de resid√™ncia
          cidadesAfetadas.forEach((cidade, index) => {
            const coord = coordsMunicipios[cidade.cidade];
            if (!coord) return;

            const isTop = index === 0;
            const color = isTop ? "#dc2626" : "#7c3aed";

            const total = cidade.casos;
            const radius = 6 + total * 2;

            const detalhesInternacao = Object.entries(cidade.internacoes)
              .map(
                ([loc, qtd]) =>
                  `${loc}: ${qtd} ${qtd === 1 ? "caso" : "casos"}`
              )
              .join(" | ");

            L.circleMarker([coord.lat, coord.lng], {
              radius,
              color,
              weight: 2,
              fillColor: color,
              fillOpacity: 0.7,
            })
              .addTo(map)
              .bindPopup(
                `<strong>${cidade.cidade}</strong><br/>` +
                  `${total} ${total === 1 ? "caso notificado" : "casos notificados"}<br/>` +
                  `<small><em>Interna√ß√µes: ${detalhesInternacao}</em></small>`
              );
          });
        };

        setTimeout(initMap, 0);
      }, [activeTab]);

      // ======================
      // RENDER PRINCIPAL
      // ======================
      return (
        <div className="min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 font-sans">
          {/* Header com Logos */}
          <div className="bg-white shadow-sm border-b border-gray-200">
            <div className="container mx-auto px-4 py-4">
              <div className="flex flex-wrap justify-between items-center gap-4">
                <img
                  src="https://raw.githubusercontent.com/luishgm/imagens-para-projetos/main/logos/cievs.png"
                  alt="CIEVS MT"
                  className="h-12 md:h-16 object-contain"
                  onError={(e) => {
                    e.currentTarget.style.display = "none";
                  }}
                />
                <img
                  src="https://raw.githubusercontent.com/luishgm/imagens-para-projetos/main/logos/rede-cievs.png"
                  alt="Rede CIEVS"
                  className="h-12 md:h-16 object-contain"
                  onError={(e) => {
                    e.currentTarget.style.display = "none";
                  }}
                />
                <img
                  src="https://raw.githubusercontent.com/luishgm/imagens-para-projetos/main/logos/logo-governo-mato-grosso.png"
                  alt="Governo MT"
                  className="h-12 md:h-16 object-contain"
                  onError={(e) => {
                    e.currentTarget.style.display = "none";
                  }}
                />
              </div>

              {/* Imagem fixa de cabe√ßalho */}
              <div className="mt-4">
                <img
                  src="Cabecalho.jpeg"
                  alt="Cabe√ßalho COE Metanol SES-MT"
                  className="w-full max-h-64 object-cover rounded-lg shadow-md"
                  onError={(e) => {
                    e.currentTarget.style.display = "none";
                  }}
                />
              </div>
            </div>
          </div>

          <div className="container mx-auto px-4 py-8">
            {/* T√≠tulo */}
            <div className="text-center mb-8">
              <h1 className="text-3xl md:text-5xl font-bold text-gray-800 mb-2">
                Painel de Monitoramento
              </h1>
              <p className="text-lg md:text-xl text-blue-600 font-semibold">
                Intoxica√ß√£o por Suspeita de Metanol (SES-MT)
              </p>
            </div>

            {/* Barra de Atualiza√ß√£o */}
            <div className="bg-gradient-to-r from-yellow-50 to-amber-50 border-l-4 border-yellow-500 p-4 rounded-lg mb-8 shadow-md">
              <div className="flex flex-col md:flex-row items-center justify-center gap-2 text-center">
                <div className="flex items-center gap-2">
                  <span className="text-yellow-600 text-lg">üìÖ</span>
                  <span className="font-semibold text-yellow-800">√öltima Atualiza√ß√£o:</span>
                </div>
                <span className="text-yellow-700">{lastUpdate}</span>
              </div>
            </div>

            {/* KPIs */}
            <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-7 gap-4 md:gap-6 mb-10">
              {kpiData.map((kpi, index) => (
                <div
                  key={kpi.label}
                  className={
                    "bg-white p-4 md:p-6 rounded-lg shadow-md border-t-4 " +
                    kpi.borderColor +
                    " transform transition-all duration-500 hover:scale-105 hover:shadow-lg " +
                    (animateCards ? "opacity-100 translate-y-0" : "opacity-0 translate-y-4")
                  }
                  style={{ transitionDelay: index * 100 + "ms" }}
                >
                  <div className="flex items-center justify-between mb-3 md:mb-4">
                    <span className="text-[10px] md:text-xs font-medium text-gray-600 uppercase tracking-wide leading-tight">
                      {kpi.label}
                    </span>
                    <span className={"text-xl md:text-2xl " + kpi.iconColor}>{kpi.icon}</span>
                  </div>
                  <div className="flex flex-col md:flex-row items-baseline gap-1 md:gap-2">
                    <span
                      className={
                        "text-3xl md:text-5xl font-bold " + kpi.textColor + " leading-none"
                      }
                    >
                      {kpi.value}
                    </span>
                    <span className="text-xs md:text-base text-gray-600">
                      {kpi.label.startsWith("√ìbitos")
                        ? (kpi.value === 1 ? "√≥bito" : "√≥bitos")
                        : kpi.label.startsWith("Casos atualmente internados")
                        ? (kpi.value === 1 ? "caso" : "casos")
                        : kpi.label.startsWith("Receberam ant√≠doto")
                        ? (kpi.value === 1 ? "caso" : "casos")
                        : kpi.value === 1
                        ? "caso"
                        : "casos"}
                    </span>
                  </div>
                </div>
              ))}
            </div>

            {/* Tabs */}
            <div className="flex flex-wrap gap-2 mb-8 bg-white p-2 rounded-lg shadow-md">
              <button
                onClick={() => setActiveTab("geral")}
                className={
                  "flex-1 min-w-[120px] px-4 py-3 rounded-lg font-semibold text-sm md:text-base transition-all duration-300 " +
                  (activeTab === "geral"
                    ? "bg-blue-600 text-white shadow-lg transform scale-105"
                    : "bg-gray-100 text-gray-600 hover:bg-gray-200")
                }
              >
                Vis√£o Geral
              </button>
              <button
                onClick={() => setActiveTab("confirmados")}
                className={
                  "flex-1 min-w-[120px] px-4 py-3 rounded-lg font-semibold text-sm md:text-base transition-all duration-300 " +
                  (activeTab === "confirmados"
                    ? "bg-red-600 text-white shadow-lg transform scale-105"
                    : "bg-gray-100 text-gray-600 hover:bg-gray-200")
                }
              >
                Confirmados
              </button>
              <button
                onClick={() => setActiveTab("investigacao")}
                className={
                  "flex-1 min-w-[120px] px-4 py-3 rounded-lg font-semibold text-sm md:text-base transition-all duration-300 " +
                  (activeTab === "investigacao"
                    ? "bg-yellow-500 text-white shadow-lg transform scale-105"
                    : "bg-gray-100 text-gray-600 hover:bg-gray-200")
                }
              >
                Em Investiga√ß√£o
              </button>
              <button
                onClick={() => setActiveTab("descartados")}
                className={
                  "flex-1 min-w-[120px] px-4 py-3 rounded-lg font-semibold text-sm md:text-base transition-all duration-300 " +
                  (activeTab === "descartados"
                    ? "bg-green-600 text-white shadow-lg transform scale-105"
                    : "bg-gray-100 text-gray-600 hover:bg-gray-200")
                }
              >
                Descartados
              </button>
              <button
                onClick={() => setActiveTab("mapa")}
                className={
                  "flex-1 min-w-[120px] px-4 py-3 rounded-lg font-semibold text-sm md:text-base transition-all duration-300 " +
                  (activeTab === "mapa"
                    ? "bg-purple-600 text-white shadow-lg transform scale-105"
                    : "bg-gray-100 text-gray-600 hover:bg-gray-200")
                }
              >
                Mapa
              </button>
            </div>

            {/* Conte√∫do das Tabs */}
            {activeTab === "geral" && (
              <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div>
                  <h3 className="text-lg font-bold text-red-700 mb-4 flex items-center gap-2">
                    <span>‚ö†Ô∏è</span> Confirmados
                  </h3>
                  {renderListaCasos(casosConfirmados, "border-red-600")}
                </div>
                <div>
                  <h3 className="text-lg font-bold text-yellow-700 mb-4 flex items-center gap-2">
                    <span>üîç</span> Em Investiga√ß√£o
                  </h3>
                  {renderListaCasos(casosEmInvestigacao, "border-yellow-500")}
                </div>
                <div>
                  <h3 className="text-lg font-bold text-green-700 mb-4 flex items-center gap-2">
                    <span>‚úÖ</span> Descartados
                  </h3>
                  {renderListaCasos(casosDescartados, "border-green-600")}
                </div>
              </div>
            )}

            {activeTab === "confirmados" && (
              <div>
                <h3 className="text-2xl font-bold text-red-700 mb-6 flex items-center gap-2">
                  <span>‚ö†Ô∏è</span> Casos Confirmados
                </h3>
                {renderListaCasos(casosConfirmados, "border-red-600")}
              </div>
            )}

            {activeTab === "investigacao" && (
              <div>
                <h3 className="text-2xl font-bold text-yellow-700 mb-6 flex items-center gap-2">
                  <span>üîç</span> Casos em Investiga√ß√£o
                </h3>
                {renderListaCasos(casosEmInvestigacao, "border-yellow-500")}
              </div>
            )}

            {activeTab === "descartados" && (
              <div>
                <h3 className="text-2xl font-bold text-green-700 mb-6 flex items-center gap-2">
                  <span>‚úÖ</span> Casos Descartados
                </h3>
                {renderListaCasos(casosDescartados, "border-green-600")}
              </div>
            )}

            {activeTab === "mapa" && (
              <div className="bg-white p-6 rounded-xl shadow-lg">
                <h3 className="text-2xl font-bold text-purple-700 mb-3 flex items-center gap-2">
                  <span>üìç</span>
                  Distribui√ß√£o Espacial dos Casos (Resid√™ncia ‚Äì MT)
                </h3>
                <p className="text-sm text-gray-600 mb-4">
                  Mapa interativo com a distribui√ß√£o dos{" "}
                  <span className="font-semibold">{totalNotificado} casos notificados</span>{" "}
                  segundo o munic√≠pio de resid√™ncia dos pacientes. O tamanho dos c√≠rculos √©
                  proporcional ao n√∫mero de casos em cada munic√≠pio. Clique nos marcadores para
                  visualizar detalhes de resid√™ncia e locais de interna√ß√£o.
                </p>

                <div
                  id="map"
                  className="w-full h-96 md:h-[480px] rounded-xl border border-gray-200 overflow-hidden"
                ></div>

                <p className="mt-4 text-xs text-gray-500">
                  Fonte: CIEVS-MT / SES-MT. Base cartogr√°fica: OpenStreetMap (meramente ilustrativa).
                  Os pontos representam munic√≠pios do estado de Mato Grosso e locais de interna√ß√£o
                  relacionados aos casos notificados de suspeita de intoxica√ß√£o por metanol.
                </p>
              </div>
            )}

            {/* Modal de Detalhes */}
            {selectedCase && (
              <div
                className="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4 z-50"
                onClick={() => setSelectedCase(null)}
              >
                <div
                  className="bg-white rounded-xl p-6 md:p-8 max-w-2xl w-full shadow-2xl"
                  onClick={(e) => e.stopPropagation()}
                >
                  <div className="flex items-center justify-between mb-6">
                    <h3 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
                      Detalhes do Caso
                      {selectedCase.isObitoMetanol && (
                        <span className="inline-flex items-center gap-1 text-xs font-semibold text-red-700 bg-red-50 border border-red-200 rounded-full px-2 py-0.5">
                          ‚ò†Ô∏è √ìbito confirmado por metanol
                        </span>
                      )}
                      {selectedCase.isObitoOutrasCausas && (
                        <span className="inline-flex items-center gap-1 text-xs font-semibold text-gray-700 bg-gray-50 border border-gray-200 rounded-full px-2 py-0.5">
                          ‚ö´ √ìbito por outras causas
                        </span>
                      )}
                    </h3>
                    <button
                      onClick={() => setSelectedCase(null)}
                      className="text-gray-400 hover:text-gray-600 transition-colors text-3xl leading-none"
                    >
                      &times;
                    </button>
                  </div>
                  <div className="space-y-6">
                    <div className="flex flex-wrap items-center gap-3">
                      <span
                        className={
                          selectedCase.statusColor +
                          " text-white text-sm font-bold px-4 py-2 rounded-full shadow-sm flex items-center gap-1"
                        }
                      >
                        {selectedCase.status === "CONFIRMADO" && "‚ö†Ô∏è"}
                        {selectedCase.status === "EM INVESTIGA√á√ÉO" && "üîç"}
                        {selectedCase.status === "DESCARTADO" && "‚úÖ"}
                        <span>{selectedCase.status}</span>
                      </span>
                      {selectedCase.gravidade && (
                        <span
                          className={
                            "px-3 py-1 rounded-full text-sm font-semibold border " +
                            getGravidadeClasses(selectedCase.gravidade)
                          }
                        >
                          Gravidade: {selectedCase.gravidade}
                        </span>
                      )}
                    </div>

                    <div className="bg-gray-50 rounded-lg p-4 border border-gray-100">
                      <div className="grid grid-cols-1 sm:grid-cols-2 gap-6 mb-4">
                        <div>
                          <p className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">
                            Resid√™ncia
                          </p>
                          <p className="font-semibold text-gray-800 text-lg">
                            {selectedCase.municipioResidencia || selectedCase.cidade}
                          </p>
                        </div>
                        <div>
                          <p className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">
                            Local de Interna√ß√£o
                          </p>
                          <p className="font-semibold text-gray-800 text-lg">
                            {selectedCase.municipioInternacao || "N√£o informado"}
                          </p>
                        </div>
                        <div>
                          <p className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">
                            Data da Notifica√ß√£o
                          </p>
                          <p className="font-semibold text-gray-800 text-lg">
                            {selectedCase.data}
                          </p>
                        </div>
                        <div className="col-span-1 sm:col-span-2">
                          <p className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">
                            Perfil do Paciente
                          </p>
                          <p className="font-semibold text-gray-800">
                            {selectedCase.perfil}
                          </p>
                        </div>
                      </div>
                    </div>

                    <div>
                      <p className="text-sm font-medium text-gray-500 mb-2">
                        Situa√ß√£o Cl√≠nica / Laboratorial
                      </p>
                      <p className="text-gray-700 bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500 text-sm md:text-base leading-relaxed">
                        {getDescricaoPadrao(selectedCase)}
                      </p>
                    </div>

                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                      <div className="bg-gray-50 rounded-lg p-3 border border-gray-100">
                        <p className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">
                          Evolu√ß√£o
                        </p>
                        <p className="text-sm text-gray-700">
                          {selectedCase.evolucao}
                        </p>
                      </div>
                      <div className="bg-gray-50 rounded-lg p-3 border border-gray-100">
                        <p className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">
                          Manejo Hospitalar
                        </p>
                        <p className="text-xs text-gray-700">
                          <span className="font-semibold">Necessitou hospitaliza√ß√£o:</span>{" "}
                          {formatStatusSimNao(selectedCase.necessitouHospitalizacao)}
                        </p>
                        <p className="text-xs text-gray-700 mt-1">
                          <span className="font-semibold">Permanece hospitalizado:</span>{" "}
                          {formatStatusSimNao(selectedCase.permaneceHospitalizado)}
                        </p>
                        <p className="text-xs text-gray-700 mt-1">
                          <span className="font-semibold">Recebeu ant√≠doto:</span>{" "}
                          {formatStatusSimNao(selectedCase.recebeuAntidoto)}
                        </p>
                      </div>
                    </div>
                  </div>

                  <div className="mt-8 flex justify-end">
                    <button
                      onClick={() => setSelectedCase(null)}
                      className="px-6 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold rounded-lg transition-colors"
                    >
                      Fechar
                    </button>
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>